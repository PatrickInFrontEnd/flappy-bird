!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e);var s=class{constructor(t,e){this.setupCoordinates(t,e)}setupCoordinates(t,e){this.x=t,this.y=e}};var r=class extends s{constructor(t,e,i,s){super(t,e),this.w=i,this.h=s}};function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class n{constructor(t,e){h(this,"generateConstants",()=>{this.__WIDTH_OF_PIPE=80,this.__HEIGHT=parseInt((Math.random()*this.ctx.canvas.height+100)%(this.ctx.canvas.height-150)),this.__HEIGHT<50&&(this.__HEIGHT=50)}),h(this,"generateParamsOfPipes",()=>{this.upperPipe=new r(this.cw,0,this.__WIDTH_OF_PIPE,this.__HEIGHT);const t=this.__HEIGHT+150,e=this.ch-t;this.bottomPipe=new r(this.cw,t,this.__WIDTH_OF_PIPE,e)}),h(this,"animatePipes",()=>{this.upperPipe.x-=this.__SPEED,this.bottomPipe.x-=this.__SPEED}),h(this,"increaseSpeed",()=>{this.__SPEED++}),h(this,"updatePipes",({upperPipeSprite:t,bottomPipeSprite:e},i)=>{i&&this.__SPEED!==i&&(this.__SPEED=i),this.animatePipes(),this.drawPipes({upperPipeSprite:t,bottomPipeSprite:e})}),this.ctx=t,this.ch=this.ctx.canvas.height,this.cw=this.ctx.canvas.width,this.__SPEED=e,this.pipePassed=!1,this.generateConstants(),this.generateParamsOfPipes()}drawPipes({upperPipeSprite:t,bottomPipeSprite:e}){const{upperPipeColumn:i,upperPipeSlot:s}=t,{bottomPipeColumn:r,bottomPipeSlot:h}=e;let n=this.upperPipe.x-2,o=this.upperPipe.h-1.5*s.height,a=this.upperPipe.w+4,c=1.5*s.height,d=this.bottomPipe.x-2,p=this.bottomPipe.y,u=this.bottomPipe.w+4,l=1.5*h.height;this.ctx.drawImage(i,this.upperPipe.x,this.upperPipe.y,this.upperPipe.w,this.upperPipe.h),this.ctx.drawImage(s,n,o,a,c),this.ctx.drawImage(r,this.bottomPipe.x,this.bottomPipe.y,this.bottomPipe.w,this.bottomPipe.h),this.ctx.drawImage(h,d,p,u,l)}}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var a=class{constructor(){o(this,"addKeyListener",t=>{["keydown","keyup"].forEach(e=>{t.addEventListener(e,this.handleEvent)})}),o(this,"removeKeyListener",t=>{["keydown","keyup"].forEach(e=>{t.removeEventListener(e,this.handleEvent)})}),o(this,"addKeyMapping",(t,e)=>{this.mappedKeys.set(t,e)}),o(this,"handleEvent",t=>{const{code:e}=t;if(!this.mappedKeys.has(e))return;t.preventDefault();const i="keydown"===t.type?1:0;this.keyState.get(e)!==i&&(this.keyState.set(e,i),this.mappedKeys.get(e)(i))}),o(this,"addClickListener",(t,e)=>{this.clickMap.set("mousedown",e),["mousedown","mouseup"].forEach(e=>{t.addEventListener(e,this.handleClickEvent)})}),o(this,"removeClickListener",t=>{["mousedown","mouseup"].forEach(e=>{t.removeEventListener(e,this.handleClickEvent)})}),o(this,"handleClickEvent",t=>{if(!this.clickMap.has("mousedown"))return;t.preventDefault();const e="mousedown"===t.type?1:0;return this.clickState.get("mousedown")!==e&&this.clickState.set("mousedown",e),this.clickMap.get("mousedown")(this.clickState.get("mousedown"))}),this.mappedKeys=new Map,this.keyState=new Map,this.clickMap=new Map,this.clickState=new Map}};function c(t,e,i,s,r){let h=r;if("in"===t){if(void 0===r&&(h=0),!(h<=100))return e.globalAlpha=1,void(s&&s(e));{const t=d(h);e.globalAlpha=t,e.clearRect(0,0,e.canvas.width,e.canvas.height),i(e),h++,requestAnimationFrame(()=>{c("in",e,i,s,h)})}}else if("out"===t){if(void 0===r&&(h=100),!(h>=0))return e.globalAlpha=1,void(s&&s(e));{const t=d(h);e.globalAlpha=t,e.clearRect(0,0,e.canvas.width,e.canvas.height),i(e),h--,requestAnimationFrame(()=>{c("out",e,i,s,h)})}}else console.warn("There are two types of animation - 'in' and 'out'. Neither of them given.")}function d(t){let e;return e=t<10?`0.0${t}`:t>=10&&t<100?`0.${t}`:"1",e}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class u extends s{constructor(t,e){super(100,t.canvas.height/2),p(this,"initDrawFrame",(t,e)=>{e.drawImage(t,this.x,this.y,this.width,this.height)}),p(this,"draw",(t,e)=>{const i=function(t,e,i){const s=t.length;return t[Math.floor(i/e)%s]}(t,4,e);this.ctx.drawImage(i,this.x,this.y,this.width,this.height)}),p(this,"update",(t,e,i)=>{this.jumpSound||(this.jumpSound=i),this.velocity+=this.__GRAVITY,this.y+=this.velocity,this.updateRadiusCoordinates(this.x,this.y),this.checkPosition(),this.draw(t,e)}),p(this,"playSound",t=>{t.currentTime=0,t.play()}),p(this,"updateRadiusCoordinates",(t,e)=>{this.radius.x=t+this.width/2,this.radius.y=e+this.height/2}),p(this,"checkPosition",()=>this.y+this.height>=this.ctx.canvas.height?(this.velocity=0,this.y=this.ctx.canvas.height-this.height,!0):this.y<=0&&(this.velocity=0,this.y=0,!0)),p(this,"jump",t=>{t&&!0===this.allowPlaying&&(this.velocity=0,this.velocity+=this.upForce,this.playSound(this.jumpSound))}),p(this,"stopPlaying",()=>{this.allowPlaying=!1}),p(this,"startPlaying",()=>{this.allowPlaying=!0}),p(this,"collided",({upperPipe:t,bottomPipe:e})=>!(this.x+this.width-10<t.x||this.x>t.x+t.w)&&(this.radius.y+this.height/2-5>=e.y||this.radius.y-this.height/2+this.height/4<=t.y+t.h)),this.width=50,this.height=32,this.radius=new s(0,0),this.ctx=t,this.__GRAVITY=.6,this.velocity=0,this.upForce=-8,this.allowPlaying=e,this.jumpSound=void 0}}function l(t,{sx:e,sy:i,width:s,height:r}){const h=document.createElement("canvas"),n=h.getContext("2d");return h.width=s,h.height=r,n.drawImage(t,e,i,s,r,0,0,s,r),h}async function m(){const t="./img/sprites.json";return fetch(t).then(e=>{if(!e.ok)throw Error(`Response from ${t} failed, ${e.statusText}`);return e.json()}).catch(t=>{console.error("Something went wrong. ",t)})}async function g(){const t="./img/menuCords.json";return fetch(t).then(e=>{if(!e.ok)throw Error(`Response from ${t} failed, ${e.statusText}`);return e.json()}).catch(t=>{console.error("Something went wrong. ",t)})}async function S(t){const e=new Image;return new Promise(i=>{e.addEventListener("load",()=>{i(e)}),e.src=t})}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var y=class{constructor({bgSpriteImg:t,entitySpriteImg:e,spritesJSON:i}){w(this,"addSprite",(t,e)=>{if(this.spritesSheet.has(t))return;const i="entity"===e?this.images.entity:this.images.background;this.spritesSheet.set(t,function(t,e,i){try{const s=e;if(!s)throw Error("Image couldn't be loaded.");const r=i[t];if(!r)throw Error("Wrong name of sprite: "+t);if(r.frames){return r.frames.map(t=>l(s,t))}return l(s,r)}catch(t){console.error("Something went wrong ",t)}}(t,i,this.spriteJSON))}),w(this,"addSprites",(t,...e)=>{e.forEach(e=>this.addSprite(e,t))}),w(this,"getSprite",t=>{try{if(!this.spritesSheet.has(t))throw Error("Incorrect name typed: "+t);return this.spritesSheet.get(t)}catch(t){console.error("Something went wrong. ",t)}}),w(this,"getAllSprites",(...t)=>t.map(t=>this.getSprite(t))),this.spritesSheet=new Map,this.images={entity:e,background:t},this.spriteJSON=i}};function b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class f{constructor(){b(this,"addSound",(t,e,i)=>{try{if(!e)throw Error("U have to put a sound in arguments list no one given.");i&&(e.volume=i),this.sounds.set(t,e)}catch(t){console.error("Something went wrong with your Sound Maker:",t)}}),b(this,"getSound",t=>{try{if(!this.sounds.has(t))throw Error(`Name '${t}' is incorrect.`);return this.sounds.get(t)}catch(t){console.error("Something went wrong with your Sound Maker:",t)}}),b(this,"playSound",t=>{t.currentTime=0,t.play()}),b(this,"stopSound",t=>{t.currentTime=0,t.pause()}),this.sounds=new Map}}function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class k extends s{constructor(t,e,i){super(),P(this,"drawTile",t=>{this.isHidden||t.drawImage(this.image,0,0,this.image.width,this.image.height,this.x,this.y,this.width,this.height)}),P(this,"animateHiddenTile",t=>{t.drawImage(this.image,0,0,this.image.width,this.image.height,this.x,this.y,this.width,this.height)}),P(this,"hideTile",t=>{this.banClick(),this.animateHiddenTile(t)}),P(this,"showTile",t=>{this.allowClick(),this.drawTile(t)}),P(this,"allowClick",()=>{this.isHidden=!1}),P(this,"banClick",()=>{this.isHidden=!0}),P(this,"setupCoordinates",(t,e)=>{super.setupCoordinates(t,e)}),P(this,"addCallback",t=>{this.callback=t}),this.image=t,this.width=e,this.height=i,this.isHidden=!0,this.isClicked=!1,this.callback=void 0}}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var T=class{constructor(t,{bgSpriteImg:e,entitySpriteImg:i,spritesJSON:s},r,{bgMethod:h,sprite:n},o,a){v(this,"addMenuTiles",()=>{this.spritesGenerator.addSprites("menuSprites",...this.menuTileNames),this.spritesGenerator.addSprites("entity",...this.birdSkins);const[t,e,i,s,r,h,n,o,a,c,d]=this.spritesGenerator.getAllSprites(...this.menuTileNames),[p,u,l,m]=this.spritesGenerator.getAllSprites(...this.birdSkins),g={scoreBoard:t,menuIcon:e,okayIcon:i,pauseIcon:s,playIcon:r,playButton:h,getReadyTitle:n,gameOverTitle:o,flappyBirdTitle:a,tapBoardIcon:c,menuOkayIcon:d,bird_yellowSkin:p,bird_blueSkin:u,bird_graySkin:l,bird_redSkin:m};this.menuTileNames.forEach(t=>{const{width:e,height:i}=this.interfaceData[t];this.addTile(g[t],t,e,i),this.menuTiles.get(t).setupCoordinates(0,0)}),this.birdSkins.forEach(t=>{const{width:e,height:i}=this.interfaceData[t];this.addTile(g[t],t,e,i),this.menuTiles.get(t).setupCoordinates(0,0)}),this.setPositionsOfMenuTiles(this.interfaceData)}),v(this,"setPositionsOfMenuTiles",t=>{const[e,i,s,r,h,n,o,a,c,d,p]=this.menuTileNames.map(t=>this.menuTiles.get(t)),[u,l,m,g]=this.birdSkins.map(t=>this.menuTiles.get(t)),S=this.cw/2,w=this.ch/2;[[r,t.scoreBoard.width+10,0],[h,t.scoreBoard.width+10,0],[n,S-n.width/2,w-n.height/2],[i,S-i.width/2,w+n.height+50],[s,S-s.width/2,w+n.height+50],[p,S-p.width/2,w+n.height+50],[o,S-o.width/2,100],[a,S-a.width/2,100],[c,S-c.width/2,100],[d,S-d.width/2,w-d.width/2],[e,0,0],[u,85+1*u.width,100],[l,155+2*l.width,100],[m,205+3*m.width,100],[g,255+4*g.width,100]].forEach(([t,e,i])=>t.setupCoordinates(e,i))}),v(this,"addTile",(t,e,i,s)=>{this.menuTiles.set(e,new k(t,i,s))}),v(this,"drawGameMenu",t=>{["menuIcon","playButton","flappyBirdTitle"].forEach(e=>{this.menuTiles.get(e).showTile(t)})}),v(this,"initializeMenu",(t=this.ctx,{bgMethod:e,sprite:i}=this.bgLayer,s)=>{c("in",t,t=>{e(i),this.drawGameMenu(t)},()=>{!1===this.listenersAreSetUp&&(s(),this.listenersAreSetUp=!0)})}),v(this,"showMenu",t=>{this.drawGameMenu(t)}),v(this,"hideMenu",t=>{["menuIcon","playButton","flappyBirdTitle"].forEach(e=>{this.hideTile(e,t)})}),v(this,"addCallbackOnTile",(t,e)=>{this.menuTiles.get(t).addCallback(e)}),v(this,"showTile",(t,e=this.ctx)=>{this.getTile(t).showTile(e)}),v(this,"hideTile",(t,e=this.ctx)=>{this.getTile(t).hideTile(e)}),v(this,"getTile",t=>this.menuTiles.get(t)),v(this,"showSubMenu",t=>{["gameOverTitle","playButton","okayIcon","scoreBoard"].forEach(t=>{this.showTile(t)})}),v(this,"hideSubMenu",t=>{["gameOverTitle","playButton","okayIcon","scoreBoard"].forEach(e=>{this.hideTile(e,t)})}),v(this,"showReadyTitle",t=>{t&&this.showTile("getReadyTitle",t),this.showTile("getReadyTitle")}),v(this,"hideReadyTitle",t=>{t&&this.hideTile("getReadyTitle",t),this.hideTile("getReadyTitle")}),v(this,"showBirdSkins",t=>{["bird_yellowSkin","bird_blueSkin","bird_graySkin","bird_redSkin"].forEach(e=>this.showTile(e,t))}),v(this,"hideBirdSkins",t=>{["bird_yellowSkin","bird_blueSkin","bird_graySkin","bird_redSkin"].forEach(e=>this.hideTile(e,t))}),this.ctx=t,this.canvas=this.ctx.canvas,this.cw=this.canvas.width,this.ch=this.canvas.height,this.interfaceData=r,this.listenersAreSetUp=!1,this.spritesGenerator=new y({bgSpriteImg:e,entitySpriteImg:i,spritesJSON:s}),this.bgLayer={bgMethod:h,sprite:n},this.menuTileNames=Array.from(Object.keys(s)).filter(t=>"menu"===s[t].type),this.birdSkins=Array.from(Object.keys(s)).filter(t=>"birdSkin"===s[t].type),this.menuTiles=new Map,this.addMenuTiles(),this.initializeMenu(this.ctx,this.bgLayer,o)}};function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var x=class extends s{constructor(t,e){super(),I(this,"addNumberSprites",()=>{this.spritesGenerator.addSprites("number",...this.digits)}),I(this,"passedPipe",(t,e)=>t.x>=e.bottomPipe.x+e.bottomPipe.w/2&&!1===e.pipePassed&&(e.pipePassed=!0,!0)),I(this,"addPoints",(t=this.scoreValue)=>{this.score+=t}),I(this,"setBestScore",()=>{this.score>this.bestScore?(this.bestScore=this.score,this.spriteBestScore=this.spriteScore):this.bestScore=this.bestScore}),I(this,"drawScore",t=>{this.convertIntoSprite(),t.drawImage(this.spriteScore,this.scoreSpriteCoordinates.x-this.spriteScore.width/2,this.scoreSpriteCoordinates.y,this.spriteScore.width,this.spriteScore.height),this.bestScore&&this.spriteBestScore?t.drawImage(this.spriteBestScore,this.scoreSpriteCoordinates.x-this.spriteBestScore.width/2,this.scoreSpriteCoordinates.y+this.scoreboardTile.height/3,this.spriteBestScore.width,this.spriteBestScore.height):t.drawImage(this.spriteScore,this.scoreSpriteCoordinates.x-this.spriteScore.width/2,this.scoreSpriteCoordinates.y+this.scoreboardTile.height/3,this.spriteScore.width,this.spriteScore.height)}),I(this,"resetScore",()=>{this.score=0}),I(this,"convertIntoSprite",(t=`${this.score}`)=>{"number"==typeof t&&(t=`${t}`);const e=t.split("").map(t=>this.spritesGenerator.getSprite(t)),i=this.joinSprites(e);return this.spriteScore=i,i}),I(this,"joinSprites",t=>{try{const e=t.length;if(!e)throw Error("Sprites array doesn't exist.",t);this.scoreSpriteCoordinates.x=e>=7?this.scoreboardTile.x+this.scoreboardTile.width-this.scoreboardTile.width/5-this.scoreboardTile.width/6:this.scoreboardTile.x+this.scoreboardTile.width-this.scoreboardTile.width/5;const i=document.createElement("canvas");i.width=this.scoreSpriteCoordinates.width*e,i.height=this.scoreSpriteCoordinates.height;const s=i.getContext("2d");return t.forEach((t,e)=>{s.drawImage(t,0,0,t.width,t.height,e*this.scoreSpriteCoordinates.width,0,this.scoreSpriteCoordinates.width,this.scoreSpriteCoordinates.height)}),i}catch(t){console.error("Something went wrong with converting score into sprites. :",t)}}),this.score=0,this.bestScore=0,this.scoreValue=100,this.spritesGenerator=new y(t),this.scoreboardTile=e,this.spriteScore=void 0,this.spriteBestScore=void 0,this.scoreSpriteCoordinates={x:this.scoreboardTile.x+this.scoreboardTile.width-this.scoreboardTile.width/5,y:this.scoreboardTile.y+this.scoreboardTile.height/3,width:12,height:14},this.digits=[];for(let t=0;t<10;t++)this.digits.push(`${t}`);this.addNumberSprites()}};function C(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var M=class{constructor(t,{bgSpriteImg:e,entitySpriteImg:i,spritesJSON:s},r,h){C(this,"generateGameEngineParams",()=>{this.bgSpriteNames=Array.from(Object.keys(this.spritesData.spritesJSON)).filter(t=>"background"===this.spritesData.spritesJSON[t].type),this.menuSpriteNames=Array.from(Object.keys(this.spritesData.spritesJSON)).filter(t=>"menu"===this.spritesData.spritesJSON[t].type).concat(Array.from(Object.keys(this.spritesData.spritesJSON)).filter(t=>"birdSkin"===this.spritesData.spritesJSON[t].type)),this.lastFrame=void 0,this.gameProps=void 0,this.typeOfBg="light",this.allowPlaying=!1,this.pipesArray=[],this.bird=new u(this.ctx,this.allowPlaying),this.skin="yellow",this.skinOfBird="bird-"+this.skin,this.birdSkins=["bird-red","bird-blue","bird-yellow","bird-gray"],this.countFrame=0,this.spritesGenerator=new y(this.spritesData),this.soundMaker=new f}),C(this,"createGameProps",()=>{this.isGamePaused=!1,this.spritesGenerator.addSprites("background",...this.bgSpriteNames),this.spritesGenerator.addSprites("entity",...this.birdSkins);const t=this.spritesGenerator.getSprite(this.skinOfBird);this.entitySprite=t;const e=this.soundMaker.getSound("jump"),i=this.soundMaker.getSound("collided"),s=this.soundMaker.getSound("song");s.loop="true";const[r,h,n,o,a,c]=this.spritesGenerator.getAllSprites(...this.bgSpriteNames);if(!this.gameProps){const t={lightBgLayer:r,bgLayer:h,upperPipeColumn:n,upperPipeSlot:o,bottomPipeColumn:a,bottomPipeSlot:c,entity:this.entitySprite,sounds:{jumpSound:e,collidedSound:i,bgSong:s}};this.gameProps=t}}),C(this,"draw",({lightBgLayer:t,bgLayer:e,upperPipeColumn:i,upperPipeSlot:s,bottomPipeColumn:r,bottomPipeSlot:h,entity:n,sounds:{jumpSound:o,collidedSound:a,bgSong:c}})=>{const[d,p]=["pauseIcon","playIcon"].map(t=>this.menuInterface.getTile(t));this.countFrame++,this.countFrame>3600&&(this.countFrame=1),this.ctx.clearRect(0,0,this.cw,this.ch),this.handlePipes();const u="light"===this.typeOfBg?t:e;this.createBgLayer(u),this.bird.update(n,this.countFrame,o),this.drawPipes({upperPipeSprite:{upperPipeColumn:i,upperPipeSlot:s},bottomPipeSprite:{bottomPipeColumn:r,bottomPipeSlot:h}}),(this.birdCollided(this.pipesArray)||this.bird.checkPosition())&&(this.banPainting(c),this.bird.stopPlaying(),this.soundMaker.playSound(a)),this.birdPassedThePipe()&&(this.scoreResolver.addPoints(),this.scoreResolver.convertIntoSprite(this.scoreResolver.score),this.scoreResolver.setBestScore()),!0===this.allowPlaying?(this.allowedToClickAtMenu=!0,!0===this.isGamePaused?(d.hideTile(this.ctx),p.showTile(this.ctx)):(p.hideTile(this.ctx),d.showTile(this.ctx),requestAnimationFrame(()=>{this.draw({lightBgLayer:t,bgLayer:e,upperPipeColumn:i,upperPipeSlot:s,bottomPipeColumn:r,bottomPipeSlot:h,entity:n,sounds:{jumpSound:o,collidedSound:a,bgSong:c}})}))):(d.isHidden=!0,p.isHidden=!0,this.allowedToClickAtMenu=!1)}),C(this,"pauseGame",()=>{this.soundMaker.playSound(this.soundMaker.getSound("pause")),requestAnimationFrame(()=>{this.menuInterface.showTile("scoreBoard"),this.scoreResolver.drawScore(this.ctx)}),this.keyService.removeClickListener(this.canvas),this.isGamePaused=!0}),C(this,"resumeGame",()=>{this.soundMaker.playSound(this.soundMaker.getSound("play")),this.isGamePaused=!1,this.keyService.addClickListener(this.canvas,this.bird.jump),requestAnimationFrame(()=>{this.draw(this.gameProps)})}),C(this,"startDrawing",()=>{this.allowPainting(),this.draw(this.gameProps)}),C(this,"handlePipes",()=>{this.countFrame%100==0&&this.pipesArray.push(new n(this.ctx,this.__SPEED_OF_PIPES)),this.isPipeOut()&&this.pipesArray.shift()}),C(this,"birdPassedThePipe",()=>this.pipesArray.map(t=>this.scoreResolver.passedPipe(this.bird,t)).some(t=>!0===t)||!1),C(this,"createBgLayer",t=>{const e=t,i=parseInt(this.cw/e.width);for(let t=0;t<i;t++)this.ctx.drawImage(e,0,0,e.width,e.height,2*e.width*t,0,2*e.width,this.ch)}),C(this,"drawPipes",({upperPipeSprite:t,bottomPipeSprite:e})=>{this.pipesArray.forEach(i=>{i.updatePipes({upperPipeSprite:t,bottomPipeSprite:e},this.__SPEED_OF_PIPES)})}),C(this,"play",()=>{this.scoreResolver.resetScore(),this.startDrawing(),this.keyService.addKeyListener(this.canvas),this.keyService.addKeyMapping("Escape",t=>{!0===this.isGamePaused&&t?this.resumeGame():!1===this.isGamePaused&&t&&this.pauseGame()}),this.listenToJump(),this.bird.jump(1),this.canvas.removeEventListener("mousedown",this.play)}),C(this,"isPipeOut",()=>this.pipesArray.some(t=>t.upperPipe.x+t.upperPipe.w+10<=0)),C(this,"banPainting",t=>{this.allowPlaying=!1,this.keyService.removeKeyListener(this.canvas),this.lastFrame=l(this.canvas,{sx:0,sy:0,width:this.cw,height:this.ch}),setTimeout(()=>{this.showSubMenu(this.lastFrame,this.ctx,t)},1e3)}),C(this,"allowPainting",()=>{this.allowPlaying=!0,this.bird.startPlaying()}),C(this,"resetStructures",t=>{this.soundMaker.stopSound(t),this.bird.y=this.ch/2,this.pipesArray=[],this.countFrame=1}),C(this,"birdCollided",([...t])=>t.map(t=>this.bird.collided(t)).some(t=>!0===t)||!1),C(this,"setUpSkin",t=>{t&&(this.skin=t),this.skinOfBird="bird-"+this.skin,this.entitySprite=this.spritesGenerator.getSprite(this.skinOfBird),this.gameProps.entity=this.entitySprite}),C(this,"increaseSpeedOfPipes",()=>{this.__SPEED_OF_PIPES++}),C(this,"addGameSounds",()=>{this.sounds.forEach(({name:t,sound:e})=>{this.soundMaker.addSound(t,e)})}),C(this,"listenToJump",()=>{this.keyService.addClickListener(this.ctx.canvas,this.bird.jump)}),C(this,"listener",(t=this.canvas)=>{try{t.addEventListener("mousedown",t=>{const{clientX:e,clientY:i,buttons:s}=t,{top:r,left:h}=t.target.getBoundingClientRect(),n=e-h,o=i-r;this.menuSpriteNames.map(t=>this.menuInterface.menuTiles.get(t)).forEach(t=>{n>=t.x&&n<=t.x+t.width&&o>=t.y&&o<=t.y+t.height&&1===s&&!0!==t.isHidden&&t.callback&&!0===this.allowedToClickAtMenu&&(this.allowedToClickAtMenu=!1,t.callback())})})}catch(t){console.error("Something went wrong...",t)}}),C(this,"startGame",t=>{c("in",t,t=>{this.menuInterface.showReadyTitle(t)},t=>{c("out",t,this.menuInterface.hideReadyTitle,t=>{c("in",t,t=>{const e="light"===this.typeOfBg?this.gameProps.lightBgLayer:this.gameProps.bgLayer;this.createBgLayer(e),this.bird.initDrawFrame(this.gameProps.entity[0],t),this.menuInterface.showTile("tapBoardIcon",t)},()=>{this.soundMaker.playSound(this.gameProps.sounds.bgSong),this.canvas.addEventListener("mousedown",this.play)})})})}),C(this,"setCallbacksAtTilesOfMenu",()=>{const t=this.soundMaker.getSound("menuClick");this.menuInterface.addCallbackOnTile("menuIcon",()=>{this.soundMaker.playSound(t),c("out",this.ctx,t=>{this.createBgLayer(this.gameProps.bgLayer),this.menuInterface.hideMenu(t)},t=>{c("in",t,t=>{this.createBgLayer(this.gameProps.bgLayer),this.menuInterface.showBirdSkins(t),this.menuInterface.showTile("menuOkayIcon")},()=>{this.showChosenSkin(),this.allowedToClickAtMenu=!0})})}),this.menuInterface.addCallbackOnTile("okayIcon",()=>{this.soundMaker.playSound(t),this.hideSubMenu(this.lastFrame,this.ctx)}),this.menuInterface.addCallbackOnTile("menuOkayIcon",()=>{this.soundMaker.playSound(t),c("out",this.ctx,t=>{this.createBgLayer(this.gameProps.bgLayer),this.menuInterface.hideBirdSkins(t)},t=>{c("in",t,t=>{this.createBgLayer(this.gameProps.bgLayer),this.menuInterface.showMenu(t)},()=>{this.allowedToClickAtMenu=!0})})}),this.menuInterface.addCallbackOnTile("playButton",()=>{this.soundMaker.playSound(t),this.menuInterface.hideMenu(this.ctx),this.startGame(this.ctx)}),this.menuInterface.addCallbackOnTile("pauseIcon",this.pauseGame),this.menuInterface.addCallbackOnTile("playIcon",this.resumeGame),["yellow","blue","gray","red"].forEach(e=>{this.menuInterface.addCallbackOnTile(`bird_${e}Skin`,()=>{this.soundMaker.playSound(t),this.setUpSkin(e),this.ctx.clearRect(0,0,this.cw,this.ch),this.showChosenSkin(),this.allowedToClickAtMenu=!0})})}),C(this,"showChosenSkin",()=>{const t=this.menuInterface.getTile(`bird_${this.skin}Skin`),e=t.x-10,i=t.y-10,s=t.width+20,r=t.height+20;requestAnimationFrame(()=>{this.createBgLayer(this.gameProps.bgLayer),this.menuInterface.showBirdSkins(this.ctx),this.menuInterface.showTile("menuOkayIcon"),this.ctx.strokeStyle="#f5f5f5",this.ctx.lineWidth=5,this.ctx.lineJoin="bevel",this.ctx.strokeRect(e,i,s,r)})}),C(this,"showSubMenu",(t,e,i)=>{const s=this.soundMaker.getSound("gameover");this.soundMaker.playSound(s),this.resetStructures(i),this.drawSubMenu(t,e)}),C(this,"drawSubMenu",(t,e)=>{c("out",e,e=>{e.drawImage(t,0,0,t.width,t.height)},e=>{c("in",e,e=>{e.drawImage(t,0,0,t.width,t.height),this.menuInterface.showSubMenu(e),this.scoreResolver.setBestScore(),this.scoreResolver.drawScore(e)},()=>{this.allowedToClickAtMenu=!0})})}),C(this,"hideSubMenu",(t,e)=>{c("out",e,e=>{e.drawImage(t,0,0,t.width,t.height),this.menuInterface.hideSubMenu(e),this.scoreResolver.drawScore(e)},t=>{c("in",t,t=>{this.createBgLayer(this.gameProps.bgLayer),this.menuInterface.showMenu(t)},()=>{this.allowedToClickAtMenu=!0})})}),C(this,"setCursorIcon",()=>{this.canvas.style.cursor="url(img/cursor.png),auto"}),this.canvas=t,this.cw=this.canvas.width,this.ch=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.__SPEED_OF_PIPES=3,this.spritesData={bgSpriteImg:e,entitySpriteImg:i,spritesJSON:s},this.keyService=new a,this.sounds=r.map(([t,e])=>({name:t,sound:e})),this.generateGameEngineParams(),this.addGameSounds(),this.setCursorIcon(),this.createGameProps(),this.allowedToClickAtMenu=!0,this.menuInterface=new T(this.ctx,this.spritesData,h,{bgMethod:this.createBgLayer,sprite:this.gameProps.bgLayer},this.listener),this.scoreResolver=new x(this.spritesData,this.menuInterface.getTile("scoreBoard")),this.setCallbacksAtTilesOfMenu()}};async function E(t,e,i,s){const r=new Audio(`${"music"===i?"./assets/music":"./assets/gameSounds"}/${t}${s||".mp3"}`);return new Promise(t=>{r.addEventListener("canplaythrough",()=>{t(r)}),e&&(r.volume=e)})}i(0);const _=document.querySelector("#app");let O;window.addEventListener("load",(async function(){const[t,e,i,s,r,h,n,o,a,c,d]=await Promise.all([S("./img/sprites.png"),S("./img/entity_sprites.png"),m(),g(),E("song",.2,"music"),E("collided",.4,"sounds",".flac"),E("gameover",.6,"sounds"),E("jump",1,"sounds"),E("pause",1,"sounds"),E("play",1,"sounds"),E("menuClick",.8,"sounds")]);O=new M(_,{bgSpriteImg:t,entitySpriteImg:e,spritesJSON:i},[["song",r],["collided",h],["gameover",n],["jump",o],["pause",a],["play",c],["menuClick",d]],s),window.app=O}))}]);